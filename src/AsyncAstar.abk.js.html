<!DOCTYPE html>
<html>
<head>
  <title>AsyncAstar.abk.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../doc-style.css" />
  <script src="../doc-filelist.js"></script>
  <script>
    var relativeDir = "../", thisFile = "src/AsyncAstar.abk.js", defaultSidebar = true;
  </script>
  <script src="../doc-script.js"></script>
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
      <div class="heading h5">
        <a href="#stateobject%20%7Bobject%7D">StateObject {Object}</a>
      </div>
      <div class="heading h5">
        <a href="#initial%20%7Bstateobject%7D">initial {StateObject}</a>
      </div>
      <div class="heading h5">
        <a href="#neighbors%20%7Bfunction%7D">neighbors {Function}</a>
      </div>
      <div class="heading h5">
        <a href="#%5Boptional%5D%20heuristic%20%7Bfunction%7D">[optional] heuristic {Function}</a>
      </div>
      <div class="heading h5">
        <a href="#%5Boptional%5D%20timeout%20%7Binteger%7D">[optional] timeout {Integer}</a>
      </div>
      <div class="heading h5">
        <a href="#oncomplete%20%7Bfunction%7D">onComplete {Function}</a>
      </div>
      <div class="heading h5">
        <a href="#%5Boptional%5D%20ontimeout%20%7Bfunction%7D">[optional] onTimeout {Function}</a>
      </div>
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
      <tr>
        <td class="docs">
          <h1>AsyncAstar.abk.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1">&#182;</a>
</div>
<p>Require the dependencies</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">SortedHash</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./SortedHash.js&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">assert</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;assert&quot;</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">class
AsyncAstar</div>
    <div class="dox_tag_detail">
      <span>is an asynchronous, generic a-star solving algorithm. It takes in
a hash of options and calls on of two callbacks upon finding the solution,
or timing out.</span>
    </div>
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span>{Object} options See below</span>
    </div>
  </div>
</div>

<div class="dox">
  <div class="summary">
  </div>
  <div class="body">
<div class="pilwrap" id="stateobject%20%7Bobject%7D">
  <h5>
    <a href="#stateobject%20%7Bobject%7D" name="stateobject%20%7Bobject%7D" class="pilcrow">&#182;</a>
    StateObject {Object}
  </h5>
</div>


<p>An object used by the solving algorithm to represent a single state in the puzzle/game/graph. The three required fields are:</p>

<p>id {String} Uniquely identifies puzzle/game state
state {Integer} -1|0|1 Impossible|Playing|Win respectively. This a-star solver can handle impossible cases (perhaps a wall, or a pit of doom).
action {String|Integer} This is the last "thing" you had to do to get to this state. Upon solving the puzzle, the returned "path" is an array of the action attributes of the most efficient path. It might be a cardinal direction, a key-press, something that would work like this:</p>

<div class='highlight'><pre><code language=''>MyGame.takeAction(0);
MyGame.getState();
// -&gt;
// {... action: 0 ...}
</code></pre></div>

<p>Additionally, if you need to store information that is needed to determine a state's neighbors or heuristic, append those attributes to this object. This might be x/y coordinates of your player.</p>


<div class="pilwrap" id="initial%20%7Bstateobject%7D">
  <h5>
    <a href="#initial%20%7Bstateobject%7D" name="initial%20%7Bstateobject%7D" class="pilcrow">&#182;</a>
    initial {StateObject}
  </h5>
</div>


<p>An object that represents the initial state to solve from.</p>

<div class='highlight'><pre><code language=''>initial: {
id: "x1y5"
state: 0,
// action is null, because it is the starting state. Nothing came before.
action: null,
x: 1, 
y: 5
}
</code></pre></div>


<div class="pilwrap" id="neighbors%20%7Bfunction%7D">
  <h5>
    <a href="#neighbors%20%7Bfunction%7D" name="neighbors%20%7Bfunction%7D" class="pilcrow">&#182;</a>
    neighbors {Function}
  </h5>
</div>


<p>A function that accepts a single StateObject as the only parameter and returns an array of neighbors. For example:</p>

<div class='highlight'><pre><code language=''>neighbors: function(state){
var neighborStates = [];
MyGame.setPlayer({
x: state.x,
y: state.y
});
neighborStates.push(MyGame.moveUp.getState());
neighborStates.push(MyGame.moveRight.getState());
neighborStates.push(MyGame.moveDown.getState());
neighborStates.push(MyGame.moveLeft.getState());
return neighborStates;
}
</code></pre></div>

<p>Note, let's say that there is a game-rule (business rule of the game - maybe a wall or something) that is stopping the player from moving up. <code>The MyGame.moveUp.getState()</code> call should return a StateObject that has the same <code>id</code> as the original state. The A* algorithm can then understand that the move resulted in the same state. This is also how the algorithm resolves circular paths. </p>


<div class="pilwrap" id="%5Boptional%5D%20heuristic%20%7Bfunction%7D">
  <h5>
    <a href="#%5Boptional%5D%20heuristic%20%7Bfunction%7D" name="%5Boptional%5D%20heuristic%20%7Bfunction%7D" class="pilcrow">&#182;</a>
    [optional] heuristic {Function}
  </h5>
</div>


<p>A function that accepts a single StateObject as the only parameter and returns an integer - the lower the value, the better. A heuristic is an estimation of "closeness" to the end and defaults to a function returning 0 for all states. Read more about the principles of a heuristic here: <a href="http://en.wikipedia.org/wiki/A*_search_algorithm#Admissibility_and_optimality">wiki</a>. For example:</p>

<div class='highlight'><pre><code language=''>heuristic: function(state) {
var endLocation = MyGame.getEndLocation();
return Math.abs(state.x - endLocation.x) + Math.abs(state.y - endLocation.y)
}
</code></pre></div>


<div class="pilwrap" id="%5Boptional%5D%20timeout%20%7Binteger%7D">
  <h5>
    <a href="#%5Boptional%5D%20timeout%20%7Binteger%7D" name="%5Boptional%5D%20timeout%20%7Binteger%7D" class="pilcrow">&#182;</a>
    [optional] timeout {Integer}
  </h5>
</div>


<p>Number of milliseconds before timeout is called and solving halts. Defaults to no timeout.</p>


<div class="pilwrap" id="oncomplete%20%7Bfunction%7D">
  <h5>
    <a href="#oncomplete%20%7Bfunction%7D" name="oncomplete%20%7Bfunction%7D" class="pilcrow">&#182;</a>
    onComplete {Function}
  </h5>
</div>


<p>Function that is called once the solution has been found. It accepts a single argument that will have 3 attributes:</p>

<p>success {Boolean} if the puzzle was solved
actions {Array} of <code>action</code> attributes of each state to get to solution
cost {Integer} count of actions needed (actions.length - 1)</p>

<div class='highlight'><pre><code language=''>onComplete: function(result) {
if (result.success) {
console.log("The steps(" + result.cost + ") required to solve the puzzle are: ", result.actions);
} else {
console.log("There is no solution to the puzzle.");
}
}
</code></pre></div>


<div class="pilwrap" id="%5Boptional%5D%20ontimeout%20%7Bfunction%7D">
  <h5>
    <a href="#%5Boptional%5D%20ontimeout%20%7Bfunction%7D" name="%5Boptional%5D%20ontimeout%20%7Bfunction%7D" class="pilcrow">&#182;</a>
    [optional] onTimeout {Function}
  </h5>
</div>


<p>Called if the solver times out. No parameters needed.</p>

<div class='highlight'><pre><code language=''>onTimeout: function(){
console.log("Solver timed out.");
}
</code></pre></div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">var</span> <span class="nx">AsyncAstar</span> <span class="o">=</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3">&#182;</a>
</div>
<p>First, assert that there is an options object and that it contains</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nx">assert</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4">&#182;</a>
</div>
<p>an initial value,</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nx">assert</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">initial</span><span class="p">);</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5">&#182;</a>
</div>
<p>a neighbors function,</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nx">assert</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">neighbors</span><span class="p">);</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6">&#182;</a>
</div>
<p>and an onComplete function.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nx">assert</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">onComplete</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7">&#182;</a>
</div>
<p>Declare a reference to the new object to be used in callbacks.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8">&#182;</a>
</div>
<p>Set member references to the initial value,</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">this</span><span class="p">.</span><span class="nx">initial</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">initial</span><span class="p">;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9">&#182;</a>
</div>
<p>the neighbors function,</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">this</span><span class="p">.</span><span class="nx">neighbors</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">neighbors</span><span class="p">;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10">&#182;</a>
</div>
<p>the heuristic (subsituting it with a placeholder if nessessary),</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">this</span><span class="p">.</span><span class="nx">heuristic</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">heuristic</span> <span class="o">||</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">};</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11">&#182;</a>
</div>
<p>and the onComplete method.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">this</span><span class="p">.</span><span class="nx">onComplete</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">onComplete</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12">&#182;</a>
</div>
<p>Initialize a new SortedHash that compares objects based on the
"__score" attribute</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">this</span><span class="p">.</span><span class="nx">unresolved</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SortedHash</span><span class="p">(</span><span class="s2">&quot;__score&quot;</span><span class="p">);</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13">&#182;</a>
</div>
<p>and a native hash.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">this</span><span class="p">.</span><span class="nx">resolved</span> <span class="o">=</span> <span class="p">{};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14">&#182;</a>
</div>
<p>Setup the helper attributes by finding the initial heuristic,</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">this</span><span class="p">.</span><span class="nx">initial</span><span class="p">.</span><span class="nx">__h</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">heuristic</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">initial</span><span class="p">);</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15">&#182;</a>
</div>
<p>setting the depth to 0,</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">this</span><span class="p">.</span><span class="nx">initial</span><span class="p">.</span><span class="nx">__depth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16">&#182;</a>
</div>
<p>finding the composite "score",</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">this</span><span class="p">.</span><span class="nx">initial</span><span class="p">.</span><span class="nx">__score</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">initial</span><span class="p">.</span><span class="nx">__depth</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">initial</span><span class="p">.</span><span class="nx">__h</span><span class="p">;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17">&#182;</a>
</div>
<p>and seting the parent to null.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">this</span><span class="p">.</span><span class="nx">initial</span><span class="p">.</span><span class="nx">__parent</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18">&#182;</a>
</div>
<p>Add the initial state to the unresolved hash,</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">this</span><span class="p">.</span><span class="nx">unresolved</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">initial</span><span class="p">);</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19">&#182;</a>
</div>
<p>set the solved flag to false,</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">this</span><span class="p">.</span><span class="nx">solved</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20">&#182;</a>
</div>
<p>and if there is a timeout,</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">timeout</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21">&#182;</a>
</div>
<p>determine the timeout time,</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">this</span><span class="p">.</span><span class="nx">timeoutTime</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">timeout</span> <span class="o">+</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22">&#182;</a>
</div>
<p>and set the timeout function pointer</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">this</span><span class="p">.</span><span class="nx">onTimeout</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">onTimeout</span><span class="p">;</span>
  <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23">&#182;</a>
</div>
<p>Launch the solve function asynchronously </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">solve</span><span class="p">();</span>
  <span class="p">},</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24">&#182;</a>
</div>
<div class="dox">
  <div class="summary">
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">method
isTimedOut</div>
    <div class="dox_tag_detail">
      <span>will determine if the system has timed out</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">Boolean</span>
      <span>True if the system has a timeout and the time has passed the threashold.</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">AsyncAstar</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">isTimedOut</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">timeoutTime</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">timeoutTime</span> <span class="o">&lt;=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25">&#182;</a>
</div>
<div class="dox">
  <div class="summary">
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">method
Solve</div>
    <div class="dox_tag_detail">
      <span>will recursively run the a-star algorithm on the unresolved list.</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">AsyncAstar</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">solve</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26">&#182;</a>
</div>
<p>First, declare a holder for a neighbor state,</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="kd">var</span> <span class="nx">neighborState</span><span class="p">;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27">&#182;</a>
</div>
<p>and get the lowest-scored unresolved state.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="kd">var</span> <span class="nx">currentState</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">unresolved</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28">&#182;</a>
</div>
<p>If there is a state to resolve, there has not been a solution, and the system is not
timed out,</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">while</span> <span class="p">(</span><span class="nx">currentState</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">solved</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">isTimedOut</span><span class="p">())</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29">&#182;</a>
</div>
<p>find its neighbors,</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">var</span> <span class="nx">neighbors</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">neighbors</span><span class="p">(</span><span class="nx">currentState</span><span class="p">);</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30">&#182;</a>
</div>
<p>and add it to the resolved hash.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">this</span><span class="p">.</span><span class="nx">resolved</span><span class="p">[</span><span class="nx">currentState</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">currentState</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-31" id="section-31">&#182;</a>
</div>
<p>For each neighbor, and while the solver has not timed out,</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">isTimedOut</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">solved</span> <span class="o">&amp;&amp;</span> <span class="nx">n</span> <span class="o">&lt;</span> <span class="nx">neighbors</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">n</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-32" id="section-32">&#182;</a>
</div>
<p>set the neighborState to the current iteration's neighbor.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nx">neighborState</span> <span class="o">=</span> <span class="nx">neighbors</span><span class="p">[</span><span class="nx">n</span><span class="p">];</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-33" id="section-33">&#182;</a>
</div>
<p>Set the neighbor's parent to the currentState,</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nx">neighborState</span><span class="p">.</span><span class="nx">__parent</span> <span class="o">=</span> <span class="nx">currentState</span><span class="p">;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-34" id="section-34">&#182;</a>
</div>
<p>find the heuristic,</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nx">neighborState</span><span class="p">.</span><span class="nx">__h</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">heuristic</span><span class="p">(</span><span class="nx">neighborState</span><span class="p">);</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-35" id="section-35">&#182;</a>
</div>
<p>set the depth to be one more than the parent,</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nx">neighborState</span><span class="p">.</span><span class="nx">__depth</span> <span class="o">=</span> <span class="nx">currentState</span><span class="p">.</span><span class="nx">__depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-36" id="section-36">&#182;</a>
</div>
<p>and set the composite score.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nx">neighborState</span><span class="p">.</span><span class="nx">__score</span> <span class="o">=</span> <span class="nx">neighborState</span><span class="p">.</span><span class="nx">__depth</span> <span class="o">+</span> <span class="nx">neighborState</span><span class="p">.</span><span class="nx">__h</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-37" id="section-37">&#182;</a>
</div>
<p>If the neighbor is in the win state,</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if</span> <span class="p">(</span><span class="nx">neighborState</span><span class="p">.</span><span class="nx">state</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-38" id="section-38">&#182;</a>
</div>
<p>declare an empty path array,</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="p">[];</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-39" id="section-39">&#182;</a>
</div>
<p>and set the pointer to the win-state.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="kd">var</span> <span class="nx">pointer</span> <span class="o">=</span> <span class="nx">neighborState</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-40" id="section-40">&#182;</a>
</div>
<p>While the pointer is not-null,</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">while</span> <span class="p">(</span><span class="nx">pointer</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-41" id="section-41">&#182;</a>
</div>
<p>push onto the path, the pointer's action,</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="nx">path</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">pointer</span><span class="p">.</span><span class="nx">action</span><span class="p">);</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-42" id="section-42">&#182;</a>
</div>
<p>and point the pointer to the pointer's parent.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="nx">pointer</span> <span class="o">=</span> <span class="nx">pointer</span><span class="p">.</span><span class="nx">__parent</span><span class="p">;</span>
        <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-43" id="section-43">&#182;</a>
</div>
<p>After the path has been created,
set the solved flag to true,</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">this</span><span class="p">.</span><span class="nx">solved</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-44" id="section-44">&#182;</a>
</div>
<p>and return the solution to the user's defined callback.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">this</span><span class="p">.</span><span class="nx">onComplete</span><span class="p">({</span>
          <span class="nx">success</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
          <span class="nx">actions</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">reverse</span><span class="p">(),</span>
          <span class="nx">cost</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="p">});</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-45" id="section-45">&#182;</a>
</div>
<p>If the neighbor is not in the win state,</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-46" id="section-46">&#182;</a>
</div>
<p>and it is already resolved,</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">resolved</span><span class="p">[</span><span class="nx">neighborState</span><span class="p">.</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-47" id="section-47">&#182;</a>
</div>
<p>check to see if this path to the same state is more effecient (lower depth).</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="k">if</span> <span class="p">(</span><span class="nx">neighborState</span><span class="p">.</span><span class="nx">__depth</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">resolved</span><span class="p">[</span><span class="nx">neighborState</span><span class="p">.</span><span class="nx">id</span><span class="p">].</span><span class="nx">__depth</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-48" id="section-48">&#182;</a>
</div>
<p>If it is, then update the resolved hash's entry to the better version.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="k">this</span><span class="p">.</span><span class="nx">resolved</span><span class="p">[</span><span class="nx">neighborState</span><span class="p">.</span><span class="nx">id</span><span class="p">].</span><span class="nx">__parent</span> <span class="o">=</span> <span class="nx">neighborState</span><span class="p">.</span><span class="nx">__parent</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">resolved</span><span class="p">[</span><span class="nx">neighborState</span><span class="p">.</span><span class="nx">id</span><span class="p">].</span><span class="nx">__h</span> <span class="o">=</span> <span class="nx">neighborState</span><span class="p">.</span><span class="nx">__h</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">resolved</span><span class="p">[</span><span class="nx">neighborState</span><span class="p">.</span><span class="nx">id</span><span class="p">].</span><span class="nx">__depth</span> <span class="o">=</span> <span class="nx">neighborState</span><span class="p">.</span><span class="nx">__depth</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">resolved</span><span class="p">[</span><span class="nx">neighborState</span><span class="p">.</span><span class="nx">id</span><span class="p">].</span><span class="nx">__score</span> <span class="o">=</span> <span class="nx">neighborState</span><span class="p">.</span><span class="nx">__score</span><span class="p">;</span>
          <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-49" id="section-49">&#182;</a>
</div>
<p>If the state is imposible to win from,</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">neighborState</span><span class="p">.</span><span class="nx">state</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-50" id="section-50">&#182;</a>
</div>
<p>add it to the resolved hash.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="k">this</span><span class="p">.</span><span class="nx">resolved</span><span class="p">[</span><span class="nx">neighborState</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">neighborState</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-51" id="section-51">&#182;</a>
</div>
<p>Otherwise, assume that the neighbor is a resolvable state.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-52" id="section-52">&#182;</a>
</div>
<p>If it already is in the unresolved heap,</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">unresolved</span><span class="p">.</span><span class="nx">heap</span><span class="p">[</span><span class="nx">neighborState</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">neighborState</span><span class="p">.</span><span class="nx">__depth</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">unresolved</span><span class="p">.</span><span class="nx">heap</span><span class="p">[</span><span class="nx">neighborState</span><span class="p">.</span><span class="nx">id</span><span class="p">].</span><span class="nx">__depth</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-53" id="section-53">&#182;</a>
</div>
<p>update the unresolved heap with the better depth.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="k">this</span><span class="p">.</span><span class="nx">unresolved</span><span class="p">.</span><span class="nx">heap</span><span class="p">[</span><span class="nx">neighborState</span><span class="p">.</span><span class="nx">id</span><span class="p">].</span><span class="nx">__parent</span> <span class="o">=</span> <span class="nx">neighborState</span><span class="p">.</span><span class="nx">__parent</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">unresolved</span><span class="p">.</span><span class="nx">heap</span><span class="p">[</span><span class="nx">neighborState</span><span class="p">.</span><span class="nx">id</span><span class="p">].</span><span class="nx">__h</span> <span class="o">=</span> <span class="nx">neighborState</span><span class="p">.</span><span class="nx">__h</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">unresolved</span><span class="p">.</span><span class="nx">heap</span><span class="p">[</span><span class="nx">neighborState</span><span class="p">.</span><span class="nx">id</span><span class="p">].</span><span class="nx">__depth</span> <span class="o">=</span> <span class="nx">neighborState</span><span class="p">.</span><span class="nx">__depth</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">unresolved</span><span class="p">.</span><span class="nx">heap</span><span class="p">[</span><span class="nx">neighborState</span><span class="p">.</span><span class="nx">id</span><span class="p">].</span><span class="nx">__score</span> <span class="o">=</span> <span class="nx">neighborState</span><span class="p">.</span><span class="nx">__score</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-54" id="section-54">&#182;</a>
</div>
<p>If it is not in then unresolved list,</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-55" id="section-55">&#182;</a>
</div>
<p>then push it in.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="k">this</span><span class="p">.</span><span class="nx">unresolved</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">neighborState</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-56" id="section-56">&#182;</a>
</div>
<p>Set the currentState to the next best guess.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">currentState</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">unresolved</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
  <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-57" id="section-57">&#182;</a>
</div>
<p>At this point the solution has been found, there is no solution, or the system
timed out.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-58" id="section-58">&#182;</a>
</div>
<p>If the system timed out</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isTimedOut</span><span class="p">())</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-59" id="section-59">&#182;</a>
</div>
<p>notify the user if possible.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">onTimeout</span><span class="p">)</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">onTimeout</span><span class="p">();</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-60" id="section-60">&#182;</a>
</div>
<p>If the system did not time out, but there is no solution,</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">solved</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-61" id="section-61">&#182;</a>
</div>
<p>notify the user that the puzzle does not have a solution.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">this</span><span class="p">.</span><span class="nx">onComplete</span><span class="p">({</span>
      <span class="nx">success</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="nx">actions</span><span class="o">:</span> <span class="p">[],</span>
      <span class="nx">cost</span><span class="o">:</span> <span class="mi">0</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">};</span>
</pre></div>
        </td>
      </tr>
  </tbody>
</table>
  </div>
</body>
</html>
